# Script to process images and analyse them for apical fluid volume
# Sam Siljee
# 6th September 2024

---
  title: "Apical fluid analysis"
author: "Sam Siljee"
date: '2022-09-06'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Packages
library(dplyr) # Data manipulation
library(ggplot2) # Plotting
library(stringr) # String manipulation in annotations
library(tiff) # Read in .tiff files

# Files and directories
input_dir <- paste0(getwd(), "/data/")
output_dir <- paste0(getwd(), "/results/")
annotations_file <- "annotations.tsv"

# User variables
max_x_offset <- 20
magnification <- "4x" # "10X"
wash <- "post wash" # "pre wash"
```

# Load data
```{r Load data}
input_files <- list.files(input_dir) %>%
  grep(pattern = ".tif$", value = TRUE) %>%
  grep(pattern = magnification, value = TRUE) %>%
  grep(pattern = wash, value = TRUE)

data.frame(file_name = input_files) %>%
  mutate(ID = paste(str_replace(substr(file_name, start = 1, stop = 6), "-", "_"), "well_here", sep = "_"))

# Read in annotations
annotations <- read.delim(paste0(input_dir, annotations_file))

# Load functions
source("Functions.R")
```


# Convert to grey-scale image

# Extract rows of pixel values

# Align rows to give a single vector for the image

# Trim off area corresponding to the transwell wall

# Subtract background by using minimal intenstiy values

# Model curve

# calculate area under the curve